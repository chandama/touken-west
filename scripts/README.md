# Scripts Directory

This directory contains utility scripts for managing the Touken West sword database.

## JavaScript Scripts (Node.js)

### Core Juyo 48 Media Workflow

1. **match-juyo48-pdfs.js**
   - Extracts measurements from Juyo 48 PDF files
   - Matches PDFs to database entries based on sword measurements
   - Generates mapping CSV and JSON results
   - Supports Japanese and English terminology
   - Handles flexible matching (optional Sakihaba for tanto/hira-zukuri)

2. **update-juyo48-tags-26plus.js**
   - Assigns JT-48-1-XXX tags to matched swords
   - Uses the mapping CSV generated by match-juyo48-pdfs.js
   - Updates both data/index.csv and public/data/index.csv

3. **add-media-attachments-26plus.js**
   - Copies media files to public/documents/juyo48/
   - Updates MediaAttachments field with JSON array of file paths
   - Uses the mapping CSV to identify which files belong to which sword

4. **add-media-for-tagged-swords.js**
   - Alternative media attachment script
   - Adds media for ALL swords with JT-48-1-XXX tags
   - Useful for fixing swords that have tags but missing media

### Utility Scripts

5. **add-authentication-tags.js**
   - Manages authentication-based tags
   - Adds tags based on Authentication field values

6. **analyze-failed-matches.js**
   - Diagnostic tool for investigating PDF matching failures
   - Analyzes why certain PDFs didn't match database entries

7. **final-juyo48-summary.js**
   - Generates comprehensive status report
   - Shows success rates, file counts, and missing media
   - Lists all Juyo 48 swords without media attachments

8. **remove-all-juyo70-na.js**
   - Database cleanup utility
   - Removes all NA index entries with Juyo 70 authentication

## Shell Scripts

1. **add-juyo-prefix.sh**
   - Batch renaming utility for adding prefixes to files

2. **rename-juyo48-koto.sh**
   - Renames Juyo 48 Koto period files to standard format

3. **security-scan.sh**
   - Security scanning utility for the codebase
   - Uses ESLint security plugins

## Python Scripts

1. **convert-xlsx-to-csv.py**
   - Converts Excel files to CSV format
   - Useful for importing external sword data

## Typical Workflow

For adding media attachments to Juyo 48 swords:

```bash
# 1. Match PDFs to database entries
node scripts/match-juyo48-pdfs.js

# 2. Review the results in analysis/juyo48-pdf-matching-results.json

# 3. Apply tags based on successful matches
node scripts/update-juyo48-tags-26plus.js

# 4. Copy media files and update MediaAttachments field
node scripts/add-media-attachments-26plus.js

# 5. Check status
node scripts/final-juyo48-summary.js
```

## Notes

- All scripts assume they are run from the project root directory
- CSV files are synchronized between `data/` and `public/data/`
- Media files are stored in `public/documents/juyo48/`
- PDF files are expected in `temp-juyo48-koto/` directory
